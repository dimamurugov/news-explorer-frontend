!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=11)}([function(e,t,s){"use strict";s.r(t),s.d(t,"myServerConfig",(function(){return r})),s.d(t,"newsApiConfig",(function(){return n}));const r={baseUrl:"http://api.murnews.students.nomoreparties.xyz",headers:{"Content-Type":"application/json"}},n={baseUrl:"https://nomoreparties.co/news/v2/everything?",apiKey:"e487423936f948508cbe9646373e3ac5",pageSize:100,language:"ru",sortBy:"popularity",days:7}},function(e,t,s){"use strict";s.r(t),s.d(t,"formLogIn",(function(){return r})),s.d(t,"popupLogIn",(function(){return n})),s.d(t,"buttonLogIn",(function(){return i})),s.d(t,"buttonLoginInForm",(function(){return o})),s.d(t,"logInAnswerMessage",(function(){return a})),s.d(t,"formSignUp",(function(){return c})),s.d(t,"popupSignUp",(function(){return u})),s.d(t,"buttonSignUp",(function(){return d})),s.d(t,"signUpAnswerMessage",(function(){return l})),s.d(t,"buttonLoginInMessageDone",(function(){return h})),s.d(t,"popupDone",(function(){return m})),s.d(t,"buttonLogOutUser",(function(){return p})),s.d(t,"buttonSavePage",(function(){return _})),s.d(t,"buutonSearch",(function(){return g})),s.d(t,"formSearch",(function(){return f})),s.d(t,"answerSearchMessage",(function(){return b})),s.d(t,"baseTime",(function(){return v})),s.d(t,"months",(function(){return S})),s.d(t,"preloaderLoading",(function(){return y})),s.d(t,"preloaderNothing",(function(){return L})),s.d(t,"container",(function(){return C})),s.d(t,"sectionNews",(function(){return M})),s.d(t,"showMoreButton",(function(){return w})),s.d(t,"userName",(function(){return I})),s.d(t,"countArticles",(function(){return k})),s.d(t,"keyWords",(function(){return A})),s.d(t,"countKeyWords",(function(){return q})),s.d(t,"buttonBurger",(function(){return x})),s.d(t,"mobileMenu",(function(){return E})),s.d(t,"buttonCloseMenu",(function(){return U}));const r=document.querySelector(".popup__form_theme_signin"),n=document.querySelector(".popup_theme_signin"),i=document.querySelector(".header__signin_theme_button-avtorization"),o=document.querySelector(".button__logIn-form"),a=document.querySelector(".popup__error-message_theme_signin"),c=document.querySelector(".popup__form_theme_signup"),u=document.querySelector(".popup_theme_signup"),d=document.querySelector(".button__signUp"),l=document.querySelector(".popup__error-message_theme_signup"),h=document.querySelector(".popup_link_theme_done"),m=document.querySelector(".popup_theme_done"),p=document.querySelector(".header__signin_theme_button-user"),_=document.querySelector(".header__list-item_type_save-page"),g=document.querySelector(".search__button"),f=document.querySelector(".search__form"),b=document.querySelector(".search__error-message"),v={min:60,sec:60,ms:1e3},S=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],y=document.querySelector(".preloader__loading"),L=document.querySelector(".preloader__nothing"),C=document.querySelector(".place-list"),M=document.querySelector(".news-content"),w=document.querySelector(".news-content__button-uncover"),I=document.querySelector(".profile__user-name"),k=document.querySelector(".profile__count-Articles"),A=document.querySelector(".profile__key-word"),q=document.querySelector(".profile__count-topics"),x=document.querySelector(".header__burger"),E=document.querySelector(".menu"),U=document.querySelector(".menu__close")},function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return a}));var r=s(0),n=s(1);function i(){const e=r.newsApiConfig.days*n.baseTime.min*n.baseTime.sec*n.baseTime.ms,t=new Date,s=t.toISOString();return{fromDate:new Date(t.getTime()-e).toISOString(),toDate:s}}function o(e){return new URLSearchParams({q:e,from:i().fromDate,to:i().tromDate,language:r.newsApiConfig.language,pageSize:r.newsApiConfig.pageSize,apiKey:r.newsApiConfig.apiKey}).toString()}function a(e){const t=new Date(e);return`${t.getDate()} ${n.months[t.getMonth()]}, ${t.getFullYear()}`}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(e){this.url=e.baseUrl,this.headers=e.headers}signup(e,t,s){return fetch(this.url+"/signup",{method:"POST",headers:this.headers,body:JSON.stringify({name:e,email:t,password:s})}).then(e=>this._checkResponseValidity(e))}signin(e,t){return fetch(this.url+"/signin",{method:"POST",credentials:"include",headers:this.headers,body:JSON.stringify({email:e,password:t})}).then(e=>this._checkResponseValidity(e))}getUserArticles(){return fetch(this.url+"/articles",{method:"GET",headers:this.headers,credentials:"include"}).then(e=>this._checkResponseValidity(e))}createArticle({keyword:e,title:t,text:s,date:r,source:n,link:i,image:o}){return fetch(this.url+"/articles",{method:"POST",headers:this.headers,credentials:"include",body:JSON.stringify({keyword:e,title:t,text:s,date:r,source:n,link:i,image:o})}).then(e=>this._checkResponseValidity(e))}deleteArticleUser(e){return fetch(`${this.url}/articles/${e}`,{method:"DELETE",headers:this.headers,credentials:"include"}).then(e=>this._checkResponseValidity(e))}getUserMe(){return fetch(this.url+"/users/me",{method:"GET",headers:this.headers,credentials:"include"}).then(e=>this._checkResponseValidity(e))}getIdArticle(e){return this.getUserArticles().then(t=>t.data.find(t=>t.link===e))}_checkResponseValidity(e){return e.ok?e.json():e.json().then(Promise.reject.bind(Promise))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(e){this.buttonSavePage=e.buttonSavePage,this.buttonUser=e.buttonUser,this.buttonLogIn=e.buttonLogIn,this.buttonBurger=e.buttonBurger,this.mobileMenu=e.mobileMenu,this.buttonCloseMenu=e.buttonCloseMenu,this.openMobileMenu=this.openMobileMenu.bind(this),this.closeMobileMenu=this.closeMobileMenu.bind(this),this.setListeners()}render(e){if(e.isLoggedIn)return this.buttonSavePage.classList.add("header__signin_state_action"),this.buttonLogIn.classList.remove("header__signin_state_action"),this.buttonUser.classList.add("header__signin_state_action"),void(this.buttonUser.textContent=e.userName);this.buttonSavePage.classList.remove("header__signin_state_action"),this.buttonLogIn.classList.add("header__signin_state_action"),this.buttonUser.classList.remove("header__signin_state_action")}openMobileMenu(){this.mobileMenu.classList.add("menu_action_open")}closeMobileMenu(){this.mobileMenu.classList.remove("menu_action_open")}setListeners(){this.buttonBurger.addEventListener("click",this.openMobileMenu),this.buttonCloseMenu.addEventListener("click",this.closeMobileMenu)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(){}getUserData(){const e=localStorage.getItem("user");return""===e?"":JSON.parse(e)}clearUserInfo(){localStorage.setItem("user","")}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s(2);class n{constructor(e,t,s,r){this.data=e,this.isAuth=t,this.api=s,this.saveArticle=this.saveArticle.bind(this),this.deleteCardSavePage=this.deleteCardSavePage.bind(this)}templateCard(){const e=document.createElement("div");return e.insertAdjacentHTML("beforeend",'\n    <div class="card">\n      <div class="card__image card__image_theme_index-page" style="background-image:">\n        <button class="card__button"></button>\n      </div>\n      <div class="card__description">\n        <p class="card__time">2 августа, 2019</p>\n        <h3 class="card__title">Национальное достояние – парки</h3>\n        <p class="card__text">В 2016 году Америка отмечала важный юбилей: сто лет назад здесь начала складыв...</p>\n        <p class="card__author">Лента.ру</p>\n      </div>\n    </div>'),e}create(){const e=this.templateCard();let t;return this.imageCard=e.querySelector(".card__image"),this.dateCard=e.querySelector(".card__time"),this.titleCard=e.querySelector(".card__title"),this.textCard=e.querySelector(".card__text"),this.authorCard=e.querySelector(".card__author"),this.saveIcon=e.querySelector(".card__button"),t=void 0===this.data.urlToImage?"url(../../images/placeholder.png)":`url(${this.data.urlToImage})`,this.imageCard.style.backgroundImage=t,this.dateCard.textContent=Object(r.a)(this.data.publishedAt),this.titleCard.textContent=this.data.title,this.textCard.textContent=this.data.description,this.authorCard.textContent=this.data.source.name,this._renderIconSave(),this.placeCard=e.firstElementChild,this.placeCard}createArticleSavePage(){const e=this.templateCard();let t;return this.imageCard=e.querySelector(".card__image"),this.dateCard=e.querySelector(".card__time"),this.titleCard=e.querySelector(".card__title"),this.textCard=e.querySelector(".card__text"),this.authorCard=e.querySelector(".card__author"),this.saveIcon=e.querySelector(".card__button"),this.imageCard.insertAdjacentHTML("afterbegin",'<div><p class="card__teg">Природа</p></div>'),this.imageCard.classList.remove("card__image_theme_index-page"),this.tag=e.querySelector(".card__teg"),t=void 0===this.data.image?"url(https://серебро.рф/img/placeholder.png)":`url(${this.data.image})`,this.imageCard.style.backgroundImage=t,this.tag.textContent=this.data.keyword,this.dateCard.textContent=this.data.date,this.titleCard.textContent=this.data.title,this.textCard.textContent=this.data.text,this.authorCard.textContent=this.data.source,this.saveIcon.classList.add("card__button_action_delete"),this.setListenersSavePage(),this.placeCard=e.firstElementChild,this.placeCard}delete(){console.log(this),this.api.deleteArticleUser(this.data._id).then(e=>{console.log(e)})}deleteCardSavePage(e){const t=this.placeCard.closest(".card");e.stopPropagation(),t.remove(),this.delete(),location.reload(),this.removeListernesSavePage()}saveArticle(){if(this.saveIcon.classList.contains("card__button_action_click"))this.saveIcon.classList.remove("card__button_action_click"),this.delete();else{this.saveIcon.classList.add("card__button_action_click");const e={keyword:this.data.keyword,title:this.data.title,text:this.data.description,date:this.dateCard.textContent,source:this.data.source.name,link:this.data.url,image:this.data.urlToImage};this.api.createArticle(e).then(e=>{console.log("Удалил: "+e),this.removeListernes()})}}setIconSaveState(e,t){t?(e.removeAttribute("disabled"),e.classList.add("card__button_action_save"),this.saveIcon.classList.remove("card__button_save")):(e.setAttribute("disabled",!0),e.classList.remove("card__button_action_save"),this.saveIcon.classList.add("card__button_save"))}_renderIconSave(){this.isAuth?(this.setIconSaveState(this.saveIcon,!0),this.setListeners(),this._isCheakArticles(this.data.url).then(e=>{e&&(this.saveIcon.classList.add("card__button_action_click"),this.data._id=e._id)})):this.setIconSaveState(this.saveIcon,!1)}_isCheakArticles(e){return this.api.getUserArticles().then(t=>t.data.find(t=>t.link===e))}setListeners(){this.saveIcon.addEventListener("click",this.saveArticle)}setListenersSavePage(){this.saveIcon.addEventListener("click",this.deleteCardSavePage)}removeListernes(){this.saveIcon.removeEventListener("click",this.saveArticle)}removeListernesSavePage(){this.saveIcon.removeEventListener("click",this.deleteCardSavePage)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(e,t,s,r,n,i,o){this.preloaderLoading=e,this.error=t,this.container=s,this.api=r,this.sectionNews=i,this.showMoreButton=o,this.createCard=n,this.showMore=this.showMore.bind(this)}showMore(){for(let e=0;e<3;e++){if(this.saveIndexCard===this.countArticles){this.showMoreButton.classList.add("news-content__button-uncover_theme_disable");break}this.addCard(this.createCard(this.arrResult[this.saveIndexCard])),this.saveIndexCard++}}renderResults(e){this.container.innerHTML="",this.api.getArticles(e).then(t=>{if(0===t.totalResults)throw new Error;this.showMoreButton.classList.remove("news-content__button-uncover_theme_disable"),this.sectionNews.classList.add("news-content_theme_active"),this.arrResult=t.articles.map(t=>(t.keyword=e,t)),this.countArticles=t.totalResults,this.saveIndexCard=0,this.showMore()}).catch(()=>{this.renderError(!0)}).finally(()=>{this.renderLoader(!1)})}renderArticlesSavePage(e){this.container.innerHTML="",e.forEach(e=>{this.addCard(this.createCard(e))})}addCard(e){this.container.appendChild(e)}renderLoader(e){e?this.preloaderLoading.classList.add("preloader_theme_active"):this.preloaderLoading.classList.remove("preloader_theme_active")}renderError(e){e?this.error.classList.add("preloader_theme_active"):this.error.classList.remove("preloader_theme_active")}setListenersList(){this.showMoreButton.addEventListener("click",this.showMore)}}},function(e,t,s){},,,function(e,t,s){"use strict";s.r(t);s(8),s.p;class r{constructor(e,t){this.popup=e,this.funOpenPopup=t,this.close=this.close.bind(this),this.open=this.open.bind(this)}open(){this.popup.classList.add("popup_is-opened")}close(){this.popup.classList.remove("popup_is-opened")}setListeners(){this.popup.querySelector(".popup__close").addEventListener("click",this.close)}}class n extends r{constructor(e,t,s,r,n,i,o){super(e),this.form=t,this.openButton=s,this.setSubmitButtonState=r,this.clearErrorMassege=n,this.funOpenForm=i,this.funSubmitForm=o,this.openForm=this.openForm.bind(this),this.submitForm=this.submitForm.bind(this)}openForm(){this.funOpenForm()}submitForm(e){this.funSubmitForm(e)}close(){null!==this.form&&this.form.reset(),super.close()}doOnOpenForm(){this.clearErrorMassege(),this.setSubmitButtonState()}setListenersForm(){null!==this.form&&(this.openButton.addEventListener("click",this.openForm),this.form.addEventListener("submit",this.submitForm))}}class i{constructor(e,t,s){this.form=e,this.errorMessages=t,this.inputs=[...e.querySelectorAll("input")],this.answerMessage=s,this.isValidate=this.isValidate.bind(this)}checkInputValidity(e,t){this.isValidate(e),t.textContent=e.validationMessage}setSubmitButtonState(e,t){t?(e.removeAttribute("disabled"),e.classList.add("popup__button_state_actively")):(e.setAttribute("disabled",!0),e.classList.remove("popup__button_state_actively"))}setEventListeners(){this.inputs.forEach(e=>{e.addEventListener("input",t=>{const s=e.parentNode.querySelector("#error-"+e.id);this.checkInputValidity(e,s),this.setSubmitButtonState(this.form.button,this.inputs.every(this.isValidate))})})}openAnswerMessage(e){this.answerMessage.classList.add("popup__error-message_staty_actively"),this.answerMessage.textContent=e}clearAnswerMessage(){this.answerMessage.classList.remove("popup__error-message_staty_actively")}_clearErrorMassege(){this.inputs.forEach(e=>{e.parentNode.querySelector("#error-"+e.id).textContent=""}),this.answerMessage.classList.remove("popup__error-message_staty_actively")}checkInputSearch(){return""===this.inputs[0].value}isValidate(e){if(e.setCustomValidity(""),e.validity.valueMissing)return e.setCustomValidity(this.errorMessages.empty),!1;if(e.validity.tooShort||e.validity.tooLong)return e.setCustomValidity(this.errorMessages.wrongLength),!1;if(e.validity.typeMismatch&&"url"===e.type)return e.setCustomValidity(this.errorMessages.wrongUrl),!1;if(e.validity.rangeOverflow){e.getAttribute("max");return e.setCustomValidity(this.errorMessages.wrongMaxLength),!1}return e.checkValidity()}}const o={empty:"Это обязательное поле",wrongLength:"Должно быть от 8 до 30 символов",wrongUrl:"Здесь должна быть ссылка",wrongPattern:"Введите данные в верном формате",wrongMaxLength:"Максимум 30 символов"};var a=s(3),c=s(2);var u=s(4),d=s(5),l=s(6),h=s(7);const{myServerConfig:m,newsApiConfig:p}=s(0),{formLogIn:_,formSignUp:g,popupLogIn:f,popupSignUp:b,popupDone:v,buttonLogIn:S,buttonLogOutUser:y,buttonLoginInForm:L,buttonSignUp:C,buttonLoginInMessageDone:M,logInAnswerMessage:w,signUpAnswerMessage:I,buttonSavePage:k,buutonSearch:A,formSearch:q,answerSearchMessage:x,preloaderLoading:E,preloaderNothing:U,container:P,sectionNews:O,showMoreButton:F,buttonBurger:B,mobileMenu:D,buttonCloseMenu:T}=s(1),V=new a.a(m),j=new i(_,o,w);j.setEventListeners();const N=new n(f,_,S,(function(){j.setSubmitButtonState(this.form.button,!1)}),(function(){j._clearErrorMassege()}),(function(){this.doOnOpenForm(),$.close(),H.close(),this.setListeners(),this.open()}),(function(e){e.preventDefault(),V.signin(this.form.elements.email.value,this.form.elements.password.value).then(e=>{localStorage.setItem("user",JSON.stringify({email:e.email,name:e.name,id:e.id})),J.render({isLoggedIn:!0,userName:e.name}),this.close()}).catch(e=>{console.log(e),j.openAnswerMessage(e.message)})})),R=new i(g,o,I);R.setEventListeners();const $=new n(b,g,C,(function(){R.setSubmitButtonState(this.form.button,!1)}),(function(){R._clearErrorMassege()}),(function(){this.doOnOpenForm(),N.close(),L.addEventListener("click",N.openForm),this.setListeners(),this.open()}),(function(e){e.preventDefault(),V.signup(this.form.elements.name.value,this.form.elements.email.value,this.form.elements.password.value).then(e=>{this.close(),H.open()}).catch(e=>{console.log(e),R.openAnswerMessage(e.message)})})),H=new r(v),z=new d.a,J=new u.a({buttonSavePage:k,buttonUser:y,buttonLogIn:S,buttonBurger:B,mobileMenu:D,buttonCloseMenu:T}),K=new i(q,o,x),W=new class{constructor(e){this._url=e.baseUrl}getArticles(e){console.log("Я начал искать");const t=Object(c.b)(e);return fetch(`${this._url}${t}`).then(e=>this._requestHandler(e))}_addKeyWordCard(){}_requestHandler(e){return e.ok?e.json():e.json().then(Promise.reject.bind(Promise))}}(p),G=new h.a(E,U,P,W,(function(e){let t;t=!!z.getUserData();return new l.a(e,t,V,Y).create()}),O,F);function Y(){return z.getUserData().id}N.setListenersForm(),$.setListenersForm(),H.setListeners(),G.setListenersList(),M.addEventListener("click",N.openForm),y.addEventListener("click",(function(){z.clearUserInfo(),J.render({isLoggedIn:!1}),location.reload()})),A.addEventListener("click",(function(e){if(e.preventDefault(),G.renderError(!1),K.checkInputSearch())return void K.openAnswerMessage("Введите ключевое слово");K.clearAnswerMessage(),G.renderLoader(!0);const t=q.elements.searchPlace.value;G.renderResults(t)})),function(){if(z.getUserData()){console.log("Авторизирован");const e=z.getUserData().name;J.render({isLoggedIn:!0,userName:e})}}()}]);